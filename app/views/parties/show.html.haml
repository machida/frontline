- content_for :header do
  - if notice
    #notice
      .content
        = notice
  .header
    %h1= link_to @party.name, @party
    %nav.members
      %ul
        %li.all
          =link_to "all", @party
        - @party.members.each do |member|
          = content_tag_for :li, member do
            %a{:href => ""}
              = image_tag member.image ? member.image : "dummy.png"
    .times
      .now
      .remain
      .end{"data-hour" => @join.end_hour, "data-min" => @join.end_min}
        = best_in_place @join, :end_hour, type: :select, collection: (0..23).map{|i| [i, i < 10 ? "0#{i}" : i.to_s]}, nil: "00"
        &#58;
        = best_in_place @join, :end_min, type: :select, collection: [0, 15, 30, 45].map{|i| [i, i < 10 ? "0#{i}" : i.to_s]}, nil: "00"
      .leave
        %a{:href => ""} 退席

.members
  %table
    %tbody
      %tr
        - @party.members.each do |member|
          = content_tag_for :td, member do
            .member{:class => member.joins.find_by_party_id(@party.id).state}
              .header
                %h1.icon
                  %a{:href => ""}
                    = image_tag member.image ? member.image : "dummy.png"
                .information
                  %ul
                    %li.name
                      %a{:href => ""}
                        = member.name
                    %li.state
                      - if user_signed_in? && current_user == member
                        = best_in_place @join, :state, type: :select, collection: Join::STATE
                      - else
                        = member.joins.find_by_party_id(@party.id).state_text

              .body
                .current
                  .label
                    %h2 Current
                  .doing
                    %ul
                      - task = member.tasks.current(@party.id).first
                      - if task
                        = render task
                      - else
                        %li.empty
                          未選択
                  /
                    .activities
                      .add
                        %form{:name => "form1"}
                          %textarea#content.mceEditor{:cols => "15", :name => "content", :rows => "3", :tabindex => "2"}
                          %input#publish{:name => "publish", :type => "submit", :value => "POST"}
                      %ul
                        %li
                          .icon
                            %a{:href => ""}
                              %img.avatar.size128{:alt => "machida", :src => "https://si0.twimg.com/profile_images/525575524/14424182_2338889845_reasonably_small.jpg"}/
                          %p お仕事がんばってます。
                  .backlog
                    .label
                      %h2 Backlog
                    - if user_signed_in? && current_user == member
                      .add.close
                        %a{:href => ""} close
                        = form_for [@party, member.tasks.build], :remote => true do |f|
                          = f.text_area :content, :rows => 3, :cols => 30
                          = f.submit
                      .add
                        %a{:href => ""} new task
                    %ul
                      = render member.tasks.backlog(@party.id)
                    
                  .done
                    .label
                      %h2 Done

                    %ul
                      = render member.tasks.done(@party.id)
